    ┌──────────────────────────────┐
    │        USER QUERY            │
    └──────────────┬───────────────┘
                   │
                   v
    ┌──────────────────────────────┐
    │  EMBED QUERY                 │
    │  np.asarray(embed(query))    │
    └──────────────┬───────────────┘
                   │
                   v
    ┌──────────────────────────────┐
    │  TIER 1: QUERY CACHE         │
    │  query_cache_node            │
    └──────────────┬───────────────┘
        cache hit? │
          ┌────────┴────────┐
          │ YES             │ NO
          v                 v
┌───────────────────┐   ┌──────────────────────────────┐
│  STOP             │   │  ENTER RETRIEVAL LOOP        │
│  (reuse answer)   │   └──────────────┬───────────────┘
└───────────────────┘                  │
                                       v
                        ┌──────────────────────────────┐
                        │  TIER 2: CHUNK STORE SEARCH  │
                        │  cache.search_chunks         │
                        └──────────────┬───────────────┘
                                       │
                                       v
                         ┌──────────────────────────────┐
                         │  SCORE EVIDENCE              │
                         │  score_node                  │
                         └──────────────┬───────────────┘
                                        │
                                        v
                         ┌──────────────────────────────┐
                         │  DECISION NODE               │
                         │  STOP or FETCH_MORE          │
                         └──────────────┬───────────────┘
                                STOP?   │
                           ┌────────────┴────────────┐
                           │ YES                     │ NO
                           v                         v
            ┌──────────────────────────────┐   ┌──────────────────────────┐
            │  CONTEXT EXPANSION           │   │ TIER 3: PUBMED FETCH     │
            │  context_expansion_node      │   │ pubmed_fetch_node        │
            └──────────────┬───────────────┘   └──────────────┬───────────┘
                           │                                  │
                           v                                  │
            ┌──────────────────────────────┐                  │
            │  LLM ANSWER SYNTHESIS        │                  │
            │  (uses expanded context)     │                  │
            └──────────────┬───────────────┘                  │
                           │                                  │
                           v                                  │
            ┌──────────────────────────────┐                  │
            │  CACHE ADMISSION CHECK       │◀─────────────────┘
            │  should_cache(state)?        │
            └──────────────┬───────────────┘
                           │
                           v
            ┌──────────────────────────────┐
            │            END               │
            └──────────────────────────────┘

